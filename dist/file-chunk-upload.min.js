!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FileUploader=t():e.FileUploader=t()}(window,function(){return(r={},i.m=n=[function(e,t,n){e.exports=function(h){"use strict";var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function f(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[2]+606105819|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[3]-1044525330|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[4]-176418897|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[6]-1473231341|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[7]-45705983|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[8]+1770035416|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[10]-42063|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[11]-1990404162|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[12]+1804603682|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[14]-1502002290|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[15]+1236535329|0,n+=((r=(r<<22|r>>>10)+i|0)&o|i&~o)+t[1]-165796510|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[11]+643717713|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[0]-373897302|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[5]-701558691|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[15]-660478335|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[4]-405537848|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[9]+568446438|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[3]-187363961|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[13]-1444681467|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0,n+=((r=(r<<20|r>>>12)+i|0)^i^o)+t[5]-378558|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[11]+1839030562|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[14]-35309556|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[1]-1530992060|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[7]-155497632|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[10]-1094730640|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[13]+681279174|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[3]-722521979|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[6]+76029189|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[9]-640364487|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[15]+530742520|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[2]-995338651|0,n+=(i^((r=(r<<23|r>>>9)+i|0)|~o))+t[0]-198630844|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[14]-1416354905|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[5]-57434055|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[12]+1700485571|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[10]-1051523|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[1]-2054922799|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[8]+1873313359|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[6]-1560198380|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[13]+1309151649|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[4]-145523070|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[2]+718787259|0,r=((r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function l(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function c(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function i(e){var t,n,r,i,o,a,s=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(u,l(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),55<t)for(f(u,r),t=0;t<16;t+=1)r[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,r[14]=o,r[15]=a,f(u,r),u}function n(e){var t,n="";for(t=0;t<4;t+=1)n+=r[e>>8*t+4&15]+r[e>>8*t&15];return n}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=n(e[t]);return e.join("")}function o(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function s(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function u(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==a(i("hello"))&&function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function f(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(e,t){var n,r,i,o,a=this.byteLength,s=f(e,a),u=a;return t!==h&&(u=f(t,a)),u<s?new ArrayBuffer(0):(n=u-s,r=new ArrayBuffer(n),i=new Uint8Array(r),o=new Uint8Array(this,s,n),i.set(o),r)}}(),u.prototype.append=function(e){return this.appendBinary(o(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)f(this._hash,l(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=s(n)),this.reset(),n},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var n,r,i,o=t;if(e[o>>2]|=128<<(o%4<<3),55<o)for(f(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(n[2],16),i=parseInt(n[1],16)||0,e[14]=r,e[15]=i,f(this._hash,e)},u.hash=function(e,t){return u.hashBinary(o(e),t)},u.hashBinary=function(e,t){var n=a(i(e));return t?s(n):n},(u.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){var t,n=function(e,t,n){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),n?r:r.buffer}(this._buff.buffer,e,!0),r=n.length;for(this._length+=e.byteLength,t=64;t<=r;t+=64)f(this._hash,c(n.subarray(t-64,t)));return this._buff=t-64<r?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=s(n)),this.reset(),n},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e=u.prototype.getState.call(this);return e.buff=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}(e.buff),e},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return t?o:i}(e.buff,!0),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var n=a(function(e){var t,n,r,i,o,a,s=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(u,c(e.subarray(t-64,t)));for(e=t-64<s?e.subarray(t-64):new Uint8Array(0),n=e.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=e[t]<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),55<t)for(f(u,r),t=0;t<16;t+=1)r[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,r[14]=o,r[15]=a,f(u,r),u}(new Uint8Array(e)));return t?s(n):n},u}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=Number(e),this.maxLength=0<e?e:1,this.queue=[],this.uid=0,this.set=new Set,this.map={},this.index=0}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(t,[{key:"add",value:function(e,t,n){var r,i=n?"unshift":"push",o=this.uid++,a=this.queue.findIndex(function(e){return e.taskId===t});return-1===a?(r={taskId:t,taskList:[]},this.queue.unshift(r)):r=this.queue[a],r.taskList[i]({uid:o,fn:e}),this.run(),o}},{key:"run",value:function(){var a=this;Promise.resolve().then(function(){function e(){var e=a.queue[a.index],t=e.taskId,n=e.taskList;if(a.map[t])return 0===a.index?"break":(a.index=0,"continue");var r=n.shift(),i=r.uid,o=r.fn;a.set.add(i),Promise.resolve().then(function(){return o(i)}),0===n.length?a.queue.splice(a.index,1):a.index++,a.index>=a.queue.length&&(a.index=0)}e:for(;a.index<a.queue.length&&a.set.size<a.maxLength;){switch(e()){case"break":break e;case"continue":continue}}})}},{key:"done",value:function(e){this.set.has(e)&&this.set.delete(e),this.run()}},{key:"changeLength",value:function(e){e=Number(e),this.maxLength=0<e?e:1,this.run()}},{key:"pause",value:function(t){this.map[t]=!0;var e=this.queue.findIndex(function(e){return e.taskId===t});if(-1!==e){var n=this.queue[e];this.queue.splice(e,1),this.queue.push(n)}}},{key:"continue",value:function(t){delete this.map[t];var e=this.queue.findIndex(function(e){return e.taskId===t});if(-1!==e){var n=this.queue[e];this.queue.splice(e,1),this.queue.unshift(n),this.run()}}},{key:"remove",value:function(e){delete this.map[e];for(var t=this.queue.length-1;0<=t;t--)this.queue[t].taskId===e&&this.queue.splice(t,1)}}]),t}(),o=n(0),c=n.n(o);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messages={}}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"getListeners",value:function(e){var t=this.messages;return t[e=e.toLowerCase()]||(t[e]=[])}},{key:"on",value:function(e,t){var n=this.getListeners(e);-1===n.indexOf(t)&&n.push(t)}},{key:"addListener",value:function(e,t){this.on(e,t)}},{key:"fireEvent",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=this.getListeners(e),i=0;i<r.length;i++){if(!1===(t=r[i]).apply(this,n))return!1;for(;r[i]!==t;)i--}return!0}},{key:"remove",value:function(e,t){var n=this.getListeners(e),r=n.indexOf(t);return-1!==r&&(n.splice(r,1),!0)}}]),e}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return Object.prototype.toString.call(e)}function y(e){return"[object Function]"===p(e)}function v(e,t){for(var n in e=e||{},t=t||{}){var r=e[n],i=t[n];Array.isArray(i)?e[n]=v(r||[],i):"[object Object]"===p(i)?e[n]=v(r||{},i):p(r)===p(i)?e[n]=r:e[n]=i}return e}function m(t){var n=new XMLHttpRequest;return n.open(t.type||"GET",t.url,!0),n.responseType=t.responseType||"json",t.headers&&Object.keys(t.headers).forEach(function(e){n.setRequestHeader(e,t.headers[e])}),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n}function g(r,t){var e=new Promise(function(e,n){r.onload=function(){if(200<=r.status&&r.status<300){var t;try{t=JSON.parse(r.response)}catch(e){t=r.response}e(t)}else n(r)},r.onerror=function(e){return n(r)},r.onabort=function(){return n("abort")},r.send(t)});return e.abort=function(){r.abort()},e}function b(t){var n;if((t=v({},t)).type=(t.type||"GET").toUpperCase(),t.url,t.data&&(n="",Object.keys(t.data).forEach(function(e){void 0!==t.data[e]&&(n&&(n+="&"),n+="".concat(e,"=").concat(t.data[e]))})),"GET"===t.type&&n&&(t.url+="?".concat(n),n=null),"POST"===t.type){var e=t.headers||{};"json"===t.contentType?(e["Content-type"]="application/json;charset=utf-8",n=JSON.stringify(t.data)):n&&(e["Content-type"]="application/x-www-form-urlencoded;charset=utf-8"),t.headers=e}return g(m(t),n)}var k=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,w=function(){function i(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=h(this,l(i).call(this))).file=e,r.size=e.size,r.firstSize=t||262144,r.chunkSize=n||4194304,r.total=Math.ceil(r.size/r.chunkSize)||1,r.stop=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(i,s),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(i,[{key:"calculate",value:function(){var r,i,o,a=this,s=0,e=this.size,t=this.chunkSize,n=this.file,u=this.total,f=new FileReader,h=new c.a.ArrayBuffer;f.onload=function(e){if(!a.stop){var t=new c.a.ArrayBuffer;h.append(e.target.result),t.append(e.target.result);var n=t.end();++s===u&&a.fireEvent("load",h.end()),a.fireEvent("chunkLoad",{chunk:r,md5:n,index:s-1,start:i,end:o}),s!==u&&l()}},f.onerror=function(e){console.warn("oops, something went wrong."),a.fireEvent("error")};var l=function(){a.stop||(o=e<=(i=t*s)+t?e:i+t,r=k.call(n,i,o),f.readAsArrayBuffer(r))};l()}},{key:"calculateForFirstSize",value:function(){var o=this;return new Promise(function(t,n){var e=new FileReader,r=new c.a.ArrayBuffer;e.onload=function(e){r.append(e.target.result),o.stop?n():t(r.end())},e.onerror=function(e){n()};var i=o.firstSize>=o.size?o.size:o.firstSize;e.readAsArrayBuffer(k.call(o.file,0,i))})}},{key:"abort",value:function(){this.stop=!0}}]),i}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.file;return b({url:r,headers:i,data:{uploadId:n,fileName:o.name,size:o.size}})}function S(e,t,n){var r=t.uploadId,i=t.url,o=t.headers,a=t.chunk;return function(t){var e=(t=v({},t)).data,n=new FormData;for(var r in e)n.append(r,e[r]);t.type=t.type||"POST",t.headers=t.headers||{};var i=m(t);return"function"==typeof t.progress&&i.upload.addEventListener("progress",function(e){e.lengthComputable&&t.progress(e)},!1),g(i,n)}({url:i,headers:o,data:{uploadId:r,md5:t.md5,index:t.index,start:t.start,end:t.end,file:a},progress:function(e){var t=e.loaded/e.total;n(t)}})}function L(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.md5,a=t.file;return b({url:r,headers:i,data:{uploadId:n,md5:o,fileName:a.name}})}function _(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.md5,a=t.chunkMD5List,s=t.file;return b({url:r,type:"post",contentType:"json",headers:i,data:{uploadId:n,md5:o,chunkMD5List:a,fileName:s.name}})}var A=1,O=2,P=3,j=4,q=5,U={md5:"",uploadSize:0,uploadPromise:null,done:!1},C=function(){function i(e,t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.initFile(e),this.options=t,this.queue=n,this.storage=r,t.autoUpload&&this.upload()}return function(e,t,n){t&&x(e.prototype,t),n&&x(e,n)}(i,[{key:"initFile",value:function(e){this.state=0,this.uploadId="",this.md5="",this.firstMD5="",this.taskId=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}(),this.chunkList=[],this.isExistMap={},this.response=null;var t={};t.raw=e,t.name=e.name,t.ext=/\.([^.]+)$/.exec(e.name)?RegExp.$1.toLowerCase():"",t.size=e.size||0,t.lastModified=e.lastModified,t.percentage=0,t.uid=this.taskId,this.file=t}},{key:"upload",value:function(){0===this.state&&(this.state=A,this.prepare())}},{key:"prepare",value:function(){var n=this,e=this.options,t=e.firstSize,r=e.chunkSize,i=e.reupload,o=new w(this.file.raw,t,r);this.fileHandler=o,this.chunkList=new Array(o.total).fill().map(function(){return v({reupload:i},U)}),1<o.total?o.calculateForFirstSize().then(function(e){n.firstMD5=e;var t=n.storage.get(n.getKey());if(t&&t.done)return n.uploadId=t.uploadId,void n.completed(t.response);t&&t.isUploading?n.handleError(void 0,"repetitive"):n.applyForUploadId(t&&t.uploadId)}).catch(function(){}):this.applyForUploadId()}},{key:"applyForUploadId",value:function(e){var r=this,t=this.options,n=t.prepareUrl,i=t.headers,o=t.onPrepare,a=t.handlePrepare,s={url:n,headers:i,file:this.file.raw};e&&(s.uploadId=e),this.handlePromise(I,o,a,[s]).then(function(e){var t=e.uploadId,n=e.chunkMD5List;r.uploadId=t,(n||[]).forEach(function(e){return r.isExistMap[e]=!0}),r.calculateMD5()}).catch(function(e){r.handleError(e,"prepare")})}},{key:"calculateMD5",value:function(){var o=this,a=this.fileHandler;a.on("chunkLoad",function(e){var t=e.md5,n=e.index,r=e.start,i=e.end;o.chunkList[n].md5=t,-1!==[A,O].indexOf(o.state)?o.isExistMap[t]?o.chunkComleted(n,i-r):o.addToQueue(e):a.abort()}),a.on("load",function(e){o.checkMD5(e)}),a.calculate()}},{key:"addToQueue",value:function(t,e){var n=this;this.queue.add(function(e){n.uploadChunk(e,t)},this.taskId,e)}},{key:"uploadChunk",value:function(e,t){var n=this;if(-1!==[A,O].indexOf(this.state)){var r=t.chunk,i=t.md5,o=t.index,a=t.start,s=t.end,u=this.options,f=u.uploadUrl,h=u.headers,l=u.onUpload,c=u.handleUpload,d={uploadId:this.uploadId,url:f,headers:h,chunk:r,md5:i,index:o,start:a,end:s},p=this.handlePromise(S,l,c,[d,function(e){n.chunkList[o].uploadSize=e*(s-a),-1!==[A].indexOf(n.state)&&n.updatePercentage()}]);(this.chunkList[o].uploadPromise=p).then(function(){n.chunkComleted(o,s-a)}).catch(function(e){"abort"!==e&&(0<n.chunkList[o].reupload?(n.chunkList[o].reupload--,n.addToQueue(t,!0)):n.handleError(e,"upload"))}).finally(function(){n.queue.done(e),n.chunkList[o].uploadPromise=null})}else this.queue.done(e)}},{key:"chunkComleted",value:function(e,t){this.chunkList[e]&&(this.chunkList[e].uploadSize=t,this.chunkList[e].done=!0,-1!==[A].indexOf(this.state)&&(this.updatePercentage(),this.saveInfo(),this.merge()))}},{key:"checkMD5",value:function(e){var t=this;this.md5=e;var n=this.options,r=n.checkUrl,i=n.headers,o=n.onCheck,a=n.handleCheck,s={uploadId:this.uploadId,url:r,headers:i,md5:this.md5,file:this.file.raw},u=this.fileHandler.total;1===u&&this.queue.pause(this.taskId),this.handlePromise(L,o,a,[s]).then(function(e){e&&t.completed(e)}).catch(function(e){console.log(e)}).finally(function(){-1<[A].indexOf(t.state)&&1===u&&t.queue.continue(t.taskId)})}},{key:"merge",value:function(){var t=this;if(-1!==[A,O].indexOf(this.state)&&!this.chunkList.some(function(e){return!e.done})){var e=this.options,n=e.mergeUrl,r=e.headers,i=e.onMerge,o=e.handleMerge,a={uploadId:this.uploadId,url:n,headers:r,md5:this.md5,chunkMD5List:this.chunkList.map(function(e){return e.md5}),file:this.file.raw};this.handlePromise(_,i,o,[a]).then(function(e){t.completed(e)}).catch(function(e){t.handleError(e,"merge")})}}},{key:"completed",value:function(e){this.state!==P&&(this.response=e,this.file.response=e,this.state===A&&(this.state=P,this.updatePercentage(100),this.saveInfo(),this.remove(),y(this.options.success)&&this.options.success.call(this.file,this.file,e)))}},{key:"handleError",value:function(e,t){this.state!==j&&(this.state=j,this.remove(),y(this.options.error)&&this.options.error.call(this.file,this.file,e,t))}},{key:"handlePromise",value:function(e,t,n,r){var i;return r=[this.file].concat(r),y(t)&&(i=t.apply(this.file,r)),i&&function(e){return"[object Promise]"===p(e)||!!e&&y(e.then)&&y(e.cacah)&&y(e.finally)}(i)||(i=e.apply(this.file,r)),i.then(function(e){var t=e;return y(n)&&(t=n(e)),void 0===t?e:t}).catch(function(){}),i}},{key:"pause",value:function(){this.state===A&&(this.state=O,this.queue.pause(this.taskId))}},{key:"continue",value:function(){this.state===O&&(this.state=A,null===this.response?(this.queue.continue(this.taskId),this.updatePercentage(),this.merge()):this.completed(this.response))}},{key:"remove",value:function(){-1===[P,j].indexOf(this.state)&&(this.state=q),this.queue.remove(this.taskId),this.chunkList.forEach(function(e){e.uploadPromise&&e.uploadPromise.abort&&e.uploadPromise.abort()}),this.fileHandler.abort(),this.saveInfo()}},{key:"updatePercentage",value:function(e){var t;100<(t=e||(this.file.size?Math.ceil(this.chunkList.reduce(function(e,t){return e+t.uploadSize},0)/this.file.size*100):100))&&(t=100),this.file.percentage=t,y(this.options.progress)&&this.options.progress.call(this.file,this.file)}},{key:"getKey",value:function(){var e=this.file;return"".concat(e.name,"#").concat(e.size,"#").concat(e.lastModified,"#").concat(this.firstMD5)}},{key:"saveInfo",value:function(){var e=this.getKey(),t={uploadId:this.uploadId};this.state===P?(t.done=!0,t.response=this.response):-1===[j,q].indexOf(this.state)&&(t.isUploading=!0),this.storage.set(e,t,this.options.expiration)}}]),i}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function r(e){var t,n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);try{t=JSON.parse(localStorage.getItem(e))||{}}catch(e){t={}}this.name=e,this.storage=t,Object.keys(this.storage).forEach(function(e){var t=n.storage[e].time;t&&t<(new Date).getTime()&&n.remove(e)})}return function(e,t,n){t&&E(e.prototype,t),n&&E(e,n)}(r,[{key:"get",value:function(e){if(!this.storage[e])return null;var t=this.storage[e],n=t.time,r=t.value;return n&&n<(new Date).getTime()?(this.remove(e),null):r}},{key:"set",value:function(e,t,n){this.storage[e]={time:n?(new Date).getTime()+1e3*n:0,value:t},this.saveToStorage()}},{key:"remove",value:function(e){delete this.storage[e],this.saveToStorage()}},{key:"saveToStorage",value:function(){try{localStorage.setItem(this.name,JSON.stringify(this.storage))}catch(e){}}}]),r}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T={firstSize:262144,chunkSize:4194304,expiration:86400,maxConcurrent:2,autoUpload:!0,prepareUrl:"/file/prepare",uploadUrl:"/file/upload",checkUrl:"/file/check",mergeUrl:"/file/merge",headers:{},reupload:5},B=function(){function t(e){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=v(e,T),this.queue=new i(e.maxConcurrent),this.storage=new z("file-upload"),this.fileList=[],this.map={},Object.keys(this.storage.storage).forEach(function(e){var t=u.storage.get(e);t&&t.isUploading&&(t.isUploading=!1)});["upload","pause","continue"].forEach(function(s){u[s]=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=u.fileList[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a===e||a.uid===e){u.map[a.uid][s]();break}}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}},u[s+"All"]=function(){var e=!0,t=!1,n=void 0;try{for(var r,i=u.fileList[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;u.map[o.uid][s]()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}})}return function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"addFile",value:function(e,t,n,r){var i=v({success:t,error:n,progress:r},this.options),o=new C(e,i,this.queue,this.storage);return this.fileList.push(o.file),(this.map[o.file.uid]=o).file}},{key:"remove",value:function(e){for(var t in this.fileList)if(this.fileList[t]===e||this.fileList[t].uid===e){this.map[this.fileList[t].uid].remove(),delete this.map[this.fileList[t].uid],this.fileList.splice(t,1);break}}},{key:"removeAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.fileList[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.map[o.uid].remove(),delete this.map[o.uid]}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.fileList=[]}}]),t}();t.default=B}],i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)).default;function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,r});