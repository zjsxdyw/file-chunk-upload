!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FileUploader=t():e.FileUploader=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[2]+606105819|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[3]-1044525330|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[4]-176418897|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[6]-1473231341|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[7]-45705983|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[8]+1770035416|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[10]-42063|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[11]-1990404162|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[12]+1804603682|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[14]-1502002290|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[15]+1236535329|0,n+=((r=(r<<22|r>>>10)+i|0)&o|i&~o)+t[1]-165796510|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[11]+643717713|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[0]-373897302|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[5]-701558691|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[15]-660478335|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[4]-405537848|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[9]+568446438|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[3]-187363961|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[13]-1444681467|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0,n+=((r=(r<<20|r>>>12)+i|0)^i^o)+t[5]-378558|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[11]+1839030562|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[14]-35309556|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[1]-1530992060|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[7]-155497632|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[10]-1094730640|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[13]+681279174|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[3]-722521979|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[6]+76029189|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[9]-640364487|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[15]+530742520|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[2]-995338651|0,n+=(i^((r=(r<<23|r>>>9)+i|0)|~o))+t[0]-198630844|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[14]-1416354905|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[5]-57434055|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[12]+1700485571|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[10]-1051523|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[1]-2054922799|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[8]+1873313359|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[6]-1560198380|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[13]+1309151649|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[4]-145523070|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[2]+718787259|0,r=((r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,i,o,a,s,u,f=e.length,h=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=f;t+=64)n(h,r(e.substring(t-64,t)));for(e=e.substring(t-64),i=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(h,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*f).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,n(h,o),h}function a(e){var n,r="";for(n=0;n<4;n+=1)r+=t[e>>8*n+4&15]+t[e>>8*n&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function f(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function h(){this.reset()}return s(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,o,a,s,u=this.byteLength,f=t(n,u),h=u;return r!==e&&(h=t(r,u)),f>h?new ArrayBuffer(0):(i=h-f,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,f,i),a.set(s),o)}}(),h.prototype.append=function(e){return this.appendBinary(u(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)n(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},h.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=s(this._hash),e&&(n=f(n)),this.reset(),n},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,t){var r,i,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(n(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=i,e[15]=o,n(this._hash,e)},h.hash=function(e,t){return h.hashBinary(u(e),t)},h.hashBinary=function(e,t){var n=s(o(e));return t?f(n):n},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var t,r=function(e,t,n){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),n?r:r.buffer}(this._buff.buffer,e,!0),o=r.length;for(this._length+=e.byteLength,t=64;t<=o;t+=64)n(this._hash,i(r.subarray(t-64,t)));return this._buff=t-64<o?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=s(this._hash),e&&(n=f(n)),this.reset(),n},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return t?o:i}(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var r=s(function(e){var t,r,o,a,s,u,f=e.length,h=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=f;t+=64)n(h,i(e.subarray(t-64,t)));for(e=t-64<f?e.subarray(t-64):new Uint8Array(0),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(h,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*f).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,n(h,o),h}(new Uint8Array(e)));return t?f(r):r},h}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Number(t),this.maxLength=t>0?t:1,this.queue=[],this.uid=0,this.set=new Set,this.map={},this.index=0}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"add",value:function(e,t,n){var r,i=n?"unshift":"push",o=this.uid++,a=this.queue.findIndex(function(e){return e.taskId===t});return-1===a?(r={taskId:t,taskList:[]},this.queue.unshift(r)):r=this.queue[a],r.taskList[i]({uid:o,fn:e}),this.run(),o}},{key:"run",value:function(){var e=this;Promise.resolve().then(function(){var t=function(){var t=e.queue[e.index],n=t.taskId,r=t.taskList;if(e.map[n])return 0===e.index?"break":(e.index=0,"continue");var i=r.shift(),o=i.uid,a=i.fn;e.set.add(o),Promise.resolve().then(function(){return a(o)}),0===r.length?e.queue.splice(e.index,1):e.index++,e.index>=e.queue.length&&(e.index=0)};e:for(;e.index<e.queue.length&&e.set.size<e.maxLength;){switch(t()){case"break":break e;case"continue":continue}}})}},{key:"done",value:function(e){this.set.has(e)&&this.set.delete(e),this.run()}},{key:"changeLength",value:function(e){e=Number(e),this.maxLength=e>0?e:1,this.run()}},{key:"pause",value:function(e){this.map[e]=!0;var t=this.queue.findIndex(function(t){return t.taskId===e});if(-1!==t){var n=this.queue[t];this.queue.splice(t,1),this.queue.push(n)}}},{key:"continue",value:function(e){delete this.map[e];var t=this.queue.findIndex(function(t){return t.taskId===e});if(-1!==t){var n=this.queue[t];this.queue.splice(t,1),this.queue.unshift(n),this.run()}}},{key:"remove",value:function(e){delete this.map[e];for(var t=this.queue.length-1;t>=0;t--)this.queue[t].taskId===e&&this.queue.splice(t,1)}}]),e}(),o=n(0),a=n.n(o);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messages={}}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"getListeners",value:function(e){var t=this.messages;return t[e=e.toLowerCase()]||(t[e]=[])}},{key:"on",value:function(e,t){var n=this.getListeners(e);-1===n.indexOf(t)&&n.push(t)}},{key:"addListener",value:function(e,t){this.on(e,t)}},{key:"fireEvent",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=this.getListeners(e),i=0;i<r.length;i++){if(!1===(t=r[i]).apply(this,n))return!1;for(;r[i]!==t;)i--}return!0}},{key:"remove",value:function(e,t){var n=this.getListeners(e),r=n.indexOf(t);return-1!==r&&(n.splice(r,1),!0)}}]),e}();function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,y=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=l(this,c(t).call(this))).file=e,i.size=e.size,i.firstSize=n||262144,i.chunkSize=r||4194304,i.total=Math.ceil(i.size/i.chunkSize)||1,i.stop=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,u),function(e,t,n){t&&h(e.prototype,t),n&&h(e,n)}(t,[{key:"calculate",value:function(){var e,t,n,r=this,i=0,o=this.size,s=this.chunkSize,u=this.file,f=this.total,h=new FileReader,l=new a.a.ArrayBuffer;h.onload=function(o){if(!r.stop){var s=new a.a.ArrayBuffer;l.append(o.target.result),s.append(o.target.result);var u=s.end();++i===f&&r.fireEvent("load",l.end()),r.fireEvent("chunkLoad",{chunk:e,md5:u,index:i-1,start:t,end:n}),i!==f&&c()}},h.onerror=function(e){console.warn("oops, something went wrong."),r.fireEvent("error")};var c=function(){r.stop||(n=(t=s*i)+s>=o?o:t+s,e=p.call(u,t,n),h.readAsArrayBuffer(e))};c()}},{key:"calculateForFirstSize",value:function(){var e=this;return new Promise(function(t,n){var r=new FileReader,i=new a.a.ArrayBuffer;r.onload=function(r){e.stop?n():t(i.end())},r.onerror=function(e){n()};var o=e.firstSize>=e.size?e.size:e.firstSize;r.readAsArrayBuffer(p.call(e.file,0,o))})}},{key:"abort",value:function(){this.stop=!0}}]),t}(),v=function(e){return Object.prototype.toString.call(e)},m=function(e){return"[object Function]"===v(e)},g=function(e){return"[object Object]"===v(e)},b=function e(t,n){for(var r in t=t||{},n=n||{}){var i=t[r],o=n[r];Array.isArray(o)?t[r]=e(i||[],o):g(o)?t[r]=e(i||{},o):v(i)===v(o)?t[r]=i:t[r]=o}return t},k=function(e){var t=new XMLHttpRequest;return t.open(e.type||"GET",e.url,!0),t.responseType=e.responseType||"json",e.headers&&Object.keys(e.headers).forEach(function(n){t.setRequestHeader(n,e.headers[n])}),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t},w=function(e,t){var n=new Promise(function(n,r){e.onload=function(){if(e.status>=200&&e.status<300){var t;try{t=JSON.parse(e.response)}catch(n){t=e.response}n(t)}else r(e)},e.onerror=function(t){return r(e)},e.onabort=function(){return r("abort")},e.send(t)});return n.abort=function(){e.abort()},n},S=function(e){(e=b({},e)).type=(e.type||"GET").toUpperCase();var t;e.url;if(e.data&&(t="",Object.keys(e.data).forEach(function(n){void 0!==e.data[n]&&(t&&(t+="&"),t+="".concat(n,"=").concat(e.data[n]))})),"GET"===e.type&&t&&(e.url+="?".concat(t),t=null),"POST"===e.type){var n=e.headers||{};"json"===e.contentType?(n["Content-type"]="application/json;charset=utf-8",t=JSON.stringify(e.data)):t&&(n["Content-type"]="application/x-www-form-urlencoded;charset=utf-8"),e.headers=n}return w(k(e),t)};function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=1,L=2,_={md5:"",uploadSize:0,uploadPromise:null,done:!1},A=function(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.file;return S({url:r,headers:i,data:{uploadId:n,fileName:o.name,size:o.size}})},O=function(e,t,n){var r=t.uploadId,i=t.url,o=t.headers,a=t.chunk;return function(e){var t=(e=b({},e)).data,n=new FormData;for(var r in t)n.append(r,t[r]);e.type=e.type||"POST",e.headers=e.headers||{};var i=k(e);return"function"==typeof e.progress&&i.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress(t)},!1),w(i,n)}({url:i,headers:o,data:{uploadId:r,md5:t.md5,index:t.index,start:t.start,end:t.end,file:a},progress:function(e){var t=e.loaded/e.total;n(t)}})},P=function(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.md5,a=t.file;return S({url:r,headers:i,data:{uploadId:n,md5:o,fileName:a.name}})},j=function(e,t){var n=t.uploadId,r=t.url,i=t.headers,o=t.md5,a=t.chunkMD5List,s=t.file;return S({url:r,type:"post",contentType:"json",headers:i,data:{uploadId:n,md5:o,chunkMD5List:a,fileName:s.name}})},q=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initFile(t),this.options=n,this.queue=r,this.storage=i,n.autoUpload&&this.upload()}return function(e,t,n){t&&I(e.prototype,t),n&&I(e,n)}(e,[{key:"initFile",value:function(e){this.state=0,this.uploadId="",this.md5="",this.firstMD5="",this.taskId=function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}(),this.chunkList=[],this.isExistMap={},this.response=null;var t={};t.raw=e,t.name=e.name,t.ext=/\.([^.]+)$/.exec(e.name)?RegExp.$1.toLowerCase():"",t.size=e.size||0,t.lastModified=e.lastModified,t.percentage=0,t.uid=this.taskId,this.file=t}},{key:"upload",value:function(){0===this.state&&(this.state=x,this.prepare())}},{key:"prepare",value:function(){var e=this,t=this.options,n=t.firstSize,r=t.chunkSize,i=t.reupload,o=new y(this.file.raw,n,r);this.fileHandler=o,this.chunkList=new Array(o.total).fill().map(function(){return b({reupload:i},_)}),o.total>1?o.calculateForFirstSize().then(function(t){e.firstMD5=t;var n=e.storage.get(e.getKey());if(n&&n.done)return e.uploadId=n.uploadId,void e.completed(n.response);n&&n.isUploading?e.handleError(void 0,"repetitive"):e.applyForUploadId(n&&n.uploadId)}).catch(function(){}):this.applyForUploadId()}},{key:"applyForUploadId",value:function(e){var t=this,n=this.options,r=n.prepareUrl,i=n.headers,o=n.onPrepare,a=n.handlePrepare,s={url:r,headers:i,file:this.file.raw};e&&(s.uploadId=e),this.handlePromise(A,o,a,[s]).then(function(e){var n=e.uploadId,r=e.chunkMD5List;t.uploadId=n,(r||[]).forEach(function(e){return t.isExistMap[e]=!0}),t.calculateMD5()}).catch(function(e){t.handleError(e,"prepare")})}},{key:"calculateMD5",value:function(){var e=this,t=this.fileHandler;t.on("chunkLoad",function(n){var r=n.md5,i=n.index,o=n.start,a=n.end;e.chunkList[i].md5=r,-1!==[x,L].indexOf(e.state)?e.isExistMap[r]?e.chunkComleted(i,a-o):e.addToQueue(n):t.abort()}),t.on("load",function(t){e.checkMD5(t)}),t.calculate()}},{key:"addToQueue",value:function(e,t){var n=this;this.queue.add(function(t){n.uploadChunk(t,e)},this.taskId,t)}},{key:"uploadChunk",value:function(e,t){var n=this;if(-1!==[x,L].indexOf(this.state)){var r=t.chunk,i=t.md5,o=t.index,a=t.start,s=t.end,u=this.options,f=u.uploadUrl,h=u.headers,l=u.onUpload,c=u.handleUpload,d={uploadId:this.uploadId,url:f,headers:h,chunk:r,md5:i,index:o,start:a,end:s},p=this.handlePromise(O,l,c,[d,function(e){n.chunkList[o].uploadSize=e*(s-a),-1!==[x].indexOf(n.state)&&n.updatePercentage()}]);this.chunkList[o].uploadPromise=p,p.then(function(){n.chunkComleted(o,s-a)}).catch(function(e){"abort"!==e&&(n.chunkList[o].reupload>0?(n.chunkList[o].reupload--,n.addToQueue(t,!0)):n.handleError(e,"upload"))}).finally(function(){n.queue.done(e),n.chunkList[o].uploadPromise=null})}else this.queue.done(e)}},{key:"chunkComleted",value:function(e,t){this.chunkList[e]&&(this.chunkList[e].uploadSize=t,this.chunkList[e].done=!0,-1!==[x].indexOf(this.state)&&(this.updatePercentage(),this.saveInfo(),this.merge()))}},{key:"checkMD5",value:function(e){var t=this;this.md5=e;var n=this.options,r=n.checkUrl,i=n.headers,o=n.onCheck,a=n.handleCheck,s={uploadId:this.uploadId,url:r,headers:i,md5:this.md5,file:this.file.raw},u=this.fileHandler.total;1===u&&this.queue.pause(this.taskId),this.handlePromise(P,o,a,[s]).then(function(e){e&&t.completed(e)}).catch(function(e){console.log(e)}).finally(function(){[x].indexOf(t.state)>-1&&1===u&&t.queue.continue(t.taskId)})}},{key:"merge",value:function(){var e=this;if(-1!==[x,L].indexOf(this.state)&&!this.chunkList.some(function(e){return!e.done})){var t=this.options,n=t.mergeUrl,r=t.headers,i=t.onMerge,o=t.handleMerge,a={uploadId:this.uploadId,url:n,headers:r,md5:this.md5,chunkMD5List:this.chunkList.map(function(e){return e.md5}),file:this.file.raw};this.handlePromise(j,i,o,[a]).then(function(t){e.completed(t)}).catch(function(t){e.handleError(t,"merge")})}}},{key:"completed",value:function(e){3!==this.state&&(this.response=e,this.file.response=e,this.state===x&&(this.state=3,this.updatePercentage(100),this.saveInfo(),this.remove(),m(this.options.success)&&this.options.success.call(this.file,this.file,e)))}},{key:"handleError",value:function(e,t){4!==this.state&&(this.state=4,this.remove(),m(this.options.error)&&this.options.error.call(this.file,this.file,e,t))}},{key:"handlePromise",value:function(e,t,n,r){var i;return r=[this.file].concat(r),m(t)&&(i=t.apply(this.file,r)),i&&function(e){return"[object Promise]"===v(e)||!!e&&m(e.then)&&m(e.cacah)&&m(e.finally)}(i)||(i=e.apply(this.file,r)),i.then(function(e){var t=e;return m(n)&&(t=n(e)),void 0===t?e:t}).catch(function(){}),i}},{key:"pause",value:function(){this.state===x&&(this.state=L,this.queue.pause(this.taskId))}},{key:"continue",value:function(){this.state===L&&(this.state=x,null===this.response?(this.queue.continue(this.taskId),this.updatePercentage(),this.merge()):this.completed(this.response))}},{key:"remove",value:function(){3!==this.state&&(this.state=5),this.queue.remove(this.taskId),this.chunkList.forEach(function(e){e.uploadPromise&&e.uploadPromise.abort&&e.uploadPromise.abort()}),this.fileHandler.abort()}},{key:"updatePercentage",value:function(e){var t;(t=e||(this.file.size?Math.ceil(this.chunkList.reduce(function(e,t){return e+t.uploadSize},0)/this.file.size*100):100))>100&&(t=100),this.file.percentage=t,m(this.options.progress)&&this.options.progress.call(this.file,this.file)}},{key:"getKey",value:function(){var e=this.file;return"".concat(e.name,"#").concat(e.size,"#").concat(e.lastModified,"#").concat(this.firstMD5)}},{key:"saveInfo",value:function(){var e=this.getKey(),t={uploadId:this.uploadId};3===this.state?(t.done=!0,t.response=this.response):t.isUploading=!0,this.storage.set(e,t,this.options.expiration)}}]),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n,r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{n=JSON.parse(localStorage.getItem(t))||{}}catch(e){n={}}this.name=t,this.storage=n,Object.keys(this.storage).forEach(function(e){var t=r.storage[e].time;t&&t<(new Date).getTime()&&r.remove(e)})}return function(e,t,n){t&&U(e.prototype,t),n&&U(e,n)}(e,[{key:"get",value:function(e){if(!this.storage[e])return null;var t=this.storage[e],n=t.time,r=t.value;return n&&n<(new Date).getTime()?(this.remove(e),null):r}},{key:"set",value:function(e,t,n){this.storage[e]={time:n?(new Date).getTime()+1e3*n:0,value:t},this.saveToStorage()}},{key:"remove",value:function(e){delete this.storage[e],this.saveToStorage()}},{key:"saveToStorage",value:function(){try{localStorage.setItem(this.name,JSON.stringify(this.storage))}catch(e){}}}]),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z={firstSize:262144,chunkSize:4194304,expiration:86400,maxConcurrent:2,autoUpload:!0,prepareUrl:"/file/prepare",uploadUrl:"/file/upload",checkUrl:"/file/check",mergeUrl:"/file/merge",headers:{},reupload:5},M=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=b(t,z),this.queue=new i(t.maxConcurrent),this.storage=new C("file-upload"),this.fileList=[],this.map={},Object.keys(this.storage.storage).forEach(function(e){var t=n.storage.get(e);t&&t.isUploading&&(t.isUploading=!1)});["upload","pause","continue"].forEach(function(e){n[e]=function(t){var r=!0,i=!1,o=void 0;try{for(var a,s=n.fileList[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u===t||u.uid===t){n.map[u.uid][e]();break}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}},n[e+"All"]=function(){var t=!0,r=!1,i=void 0;try{for(var o,a=n.fileList[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;n.map[s.uid][e]()}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}}})}return function(e,t,n){t&&E(e.prototype,t),n&&E(e,n)}(e,[{key:"addFile",value:function(e,t,n,r){var i=b({success:t,error:n,progress:r},this.options),o=new q(e,i,this.queue,this.storage);return this.fileList.push(o.file),this.map[o.file.uid]=o,o.file}},{key:"remove",value:function(e){for(var t in this.fileList)if(this.fileList[t]===e||this.fileList[t].uid===e){this.map[this.fileList[t].uid].remove(),delete this.map[this.fileList[t].uid],this.fileList.splice(t,1);break}}},{key:"removeAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.fileList[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.map[o.uid].remove(),delete this.map[o.uid]}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.fileList=[]}}]),e}();t.default=M}]).default});